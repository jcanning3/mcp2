<p id="notice"><%= notice %></p>

<h1>Sales Reports</h1>

<% concertList = Array.new %>
<% concertCount = Hash.new %>
<% passCount = 0 %>

<table class="table table-header">
  <thead>
    <tr>
      <th>Date</th>
      <th>Vendor</th>
      <th>Concert</th>
      <th>Ticket category</th>
      <th>Description</th>
      <th class="text-right">Count</th>
      <th class="text-right">Unit price</th>
      <th colspan="3"></th>align
    </tr>
  </thead>

  <tbody>

    <% @sales_reports.order(:concert).each do |sales_report| %>
      <% if sales_report.ticket_category.name == "Festival Pass" %>
        <% passCount += sales_report.count %>
	<% countMe = false %>
      <% else %>
	<% countMe = true %>
	<% if concertList[-1] != sales_report.description %>
	  <% concertList.push(sales_report.description) if sales_report.description %>
	  <% concertCount[sales_report.description] = 0 %>
	<% end %>
      <% end %>
      <% if countMe and sales_report.description %>
        <% concertCount[sales_report.description] = concertCount[sales_report.description] + sales_report.count %>
      <% end %>

      <tr>
        <td><%= sales_report.try(:date).try(:strftime, "%a %m/%d") %></td>
        <td><%= sales_report.vendor.name %></td>
        <td><%= sales_report.try(:concert).try(:strftime, "%a %m/%d") %></td>
        <td><%= sales_report.ticket_category.name %></td>
        <td><%= sales_report.description %></td>
        <td class="text-right"><%= sales_report.count %></td>
        <td class="text-right">$<%= sales_report.unit_price %></td>
        <td><!%= link_to 'Show', sales_report, class: 'btn btn-warning btn-sm' %></td>
        <td><%= link_to 'Edit', edit_sales_report_path(sales_report), class: 'btn btn-warning btn-sm' %></td>
        <td><%= link_to 'Destroy', sales_report, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br> <br> <br>
<%= link_to 'New Sales Report', new_sales_report_path, class: 'btn btn-primary btn-lg' %>

<br> <br> <br>

<h4> Ticket Counts </h4>

<table class="table table-header">
  <thead>
    <tr>
      <th>Concert</th>
      <th class="text-right">Count</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
      <% ct = 0 %>
      <% while ct < concertList.length do %>
        <tr>
          <td><%= concertList[ct] %> </td>
          <td class="text-right"><%= concertCount[concertList[ct]] %> </td>
	  <td> </td>
        </tr>
	<% ct = ct + 1 %>

      <% end %>

  </tbody>
</table>

<br>

